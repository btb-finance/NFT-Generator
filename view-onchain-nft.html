<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pixel Cats On-Chain NFT Viewer</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
            color: white;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        h1 {
            text-align: center;
            margin-bottom: 10px;
            font-size: 2.5rem;
        }

        .subtitle {
            text-align: center;
            margin-bottom: 30px;
            opacity: 0.9;
        }

        .contract-info {
            background: rgba(255, 255, 255, 0.1);
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 30px;
        }

        .contract-info a {
            color: #ffd700;
            text-decoration: none;
        }

        .contract-info a:hover {
            text-decoration: underline;
        }

        .viewer {
            background: white;
            padding: 30px;
            border-radius: 20px;
            color: #333;
        }

        .input-group {
            margin-bottom: 20px;
        }

        label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }

        input {
            width: 200px;
            padding: 10px;
            border: 2px solid #ddd;
            border-radius: 5px;
            font-size: 16px;
        }

        button {
            padding: 10px 30px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 5px;
            font-size: 16px;
            cursor: pointer;
            margin-left: 10px;
        }

        button:hover {
            opacity: 0.9;
        }

        .nft-display {
            margin-top: 30px;
        }

        .nft-image {
            text-align: center;
            margin-bottom: 30px;
        }

        .nft-image img {
            max-width: 480px;
            width: 100%;
            border: 5px solid #667eea;
            border-radius: 10px;
            image-rendering: pixelated;
            image-rendering: -moz-crisp-edges;
            image-rendering: crisp-edges;
        }

        .metadata {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
        }

        .metadata h3 {
            margin-bottom: 15px;
            color: #667eea;
        }

        .traits {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 15px;
            margin-top: 15px;
        }

        .trait {
            background: white;
            padding: 15px;
            border-radius: 8px;
            border-left: 4px solid #667eea;
        }

        .trait-type {
            font-size: 0.9rem;
            color: #666;
            margin-bottom: 5px;
        }

        .trait-value {
            font-size: 1.1rem;
            font-weight: bold;
            color: #333;
        }

        .loading {
            text-align: center;
            padding: 50px;
            font-size: 1.2rem;
        }

        .error {
            background: #ff6b6b;
            color: white;
            padding: 15px;
            border-radius: 5px;
            margin-top: 15px;
        }

        .raw-data {
            margin-top: 20px;
        }

        .raw-data textarea {
            width: 100%;
            height: 150px;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-family: monospace;
            font-size: 12px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üê± Pixel Cats On-Chain NFT Viewer</h1>
        <p class="subtitle">100% On-Chain ‚Ä¢ Base Sepolia Testnet</p>

        <div class="contract-info">
            <p><strong>Contract Address:</strong> <a href="https://base-sepolia.blockscout.com/address/0xB72913FDE73a517457409Fdd90b1D18a012e90BC" target="_blank">0xB72913FDE73a517457409Fdd90b1D18a012e90BC</a></p>
            <p><strong>Network:</strong> Base Sepolia</p>
            <p><strong>Total Minted:</strong> <span id="totalMinted">Loading...</span></p>
        </div>

        <div class="viewer">
            <div class="input-group">
                <label for="tokenId">Token ID:</label>
                <input type="number" id="tokenId" value="0" min="0">
                <button onclick="loadNFT()">Load NFT</button>
            </div>

            <div id="nftDisplay"></div>
        </div>
    </div>

    <script src="https://cdn.ethers.io/lib/ethers-5.7.2.umd.min.js"></script>
    <script>
        const CONTRACT_ADDRESS = '0xB72913FDE73a517457409Fdd90b1D18a012e90BC';
        const RPC_URL = 'https://sepolia.base.org';

        const ABI = [
            "function tokenURI(uint256 tokenId) view returns (string)",
            "function totalMinted() view returns (uint256)",
            "function getTraits(uint256 tokenId) view returns (string background, string bodyColor, string eyeColor, string accessory, string expression, string pattern)"
        ];

        const provider = new ethers.providers.JsonRpcProvider(RPC_URL);
        const contract = new ethers.Contract(CONTRACT_ADDRESS, ABI, provider);

        async function loadTotalMinted() {
            try {
                const total = await contract.totalMinted();
                document.getElementById('totalMinted').textContent = total.toString();
            } catch (error) {
                document.getElementById('totalMinted').textContent = 'Error';
                console.error(error);
            }
        }

        async function loadNFT() {
            const tokenId = document.getElementById('tokenId').value;
            const display = document.getElementById('nftDisplay');

            display.innerHTML = '<div class="loading">Loading NFT data from blockchain...</div>';

            try {
                // Get tokenURI (fully on-chain)
                const tokenURI = await contract.tokenURI(tokenId);

                // Decode base64 JSON
                const base64Data = tokenURI.split(',')[1];
                const jsonString = atob(base64Data);
                const metadata = JSON.parse(jsonString);

                // Display NFT
                display.innerHTML = `
                    <div class="nft-display">
                        <div class="nft-image">
                            <img src="${metadata.image}" alt="${metadata.name}">
                        </div>

                        <div class="metadata">
                            <h3>${metadata.name}</h3>
                            <p>${metadata.description}</p>

                            <div class="traits">
                                ${metadata.attributes.map(attr => `
                                    <div class="trait">
                                        <div class="trait-type">${attr.trait_type}</div>
                                        <div class="trait-value">${attr.value}</div>
                                    </div>
                                `).join('')}
                            </div>

                            <div class="raw-data">
                                <h4>Raw Token URI (100% On-Chain)</h4>
                                <textarea readonly>${tokenURI}</textarea>
                            </div>
                        </div>
                    </div>
                `;
            } catch (error) {
                display.innerHTML = `
                    <div class="error">
                        <strong>Error:</strong> ${error.message}
                        <br><br>
                        Make sure the token ID exists and you're connected to Base Sepolia.
                    </div>
                `;
                console.error(error);
            }
        }

        // Load total minted on page load
        loadTotalMinted();

        // Load first NFT automatically
        loadNFT();
    </script>
</body>
</html>
